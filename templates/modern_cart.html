{% extends 'modern_base.html' %}
{% load static %}

{% block title %}Shopping Cart{% endblock %}

{% block content %}
<!-- Cart Header -->
<section class="cart-header" style="background: linear-gradient(135deg, var(--cream) 0%, var(--bg-light) 100%); padding: 60px 0;">
    <div class="container">
        <div class="row align-center">
            <div class="col">
                <h1>Your Shopping Cart</h1>
                <p>Review your selected authentic indigenous products</p>
            </div>
            <div class="col text-right">
                <nav style="font-size: 14px; color: var(--text-light);">
                    <a href="{% url 'index' %}" style="color: var(--text-light);">Home</a>
                    <span style="margin: 0 8px;">/</span>
                    <span style="color: var(--primary-color);">Cart</span>
                </nav>
            </div>
        </div>
    </div>
</section>

<!-- Cart Content -->
<section class="cart-section">
    <div class="container">
        <!-- Cart Items -->
        <div class="cart-table-container" style="background-color: var(--white); border-radius: 16px; box-shadow: var(--shadow-sm); overflow: hidden; margin-bottom: 32px;">
            <table class="cart-table">
                <thead>
                    <tr>
                        <th style="width: 60px;"></th>
                        <th style="width: 100px;">Product</th>
                        <th>Details</th>
                        <th style="width: 120px;">Price</th>
                        <th style="width: 150px;">Quantity</th>
                        <th style="width: 120px;">Total</th>
                        <th style="width: 60px;">Remove</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Cart Item 1 -->
                    <tr class="cart-item">
                        <td>
                            <input type="checkbox" checked style="width: 18px; height: 18px;">
                        </td>
                        <td>
                            <img src="{% static 'images/products/handwoven-scarf.jpg' %}" alt="Handwoven Traditional Scarf" class="cart-item-image">
                        </td>
                        <td>
                            <div class="item-details">
                                <h4 style="margin-bottom: 8px; color: var(--text-dark);">Handwoven Traditional Scarf</h4>
                                <p style="color: var(--text-light); font-size: 14px; margin-bottom: 4px;">Traditional Weaves</p>
                                <div style="display: flex; gap: 16px; font-size: 14px; color: var(--text-light);">
                                    <span>Color: Traditional Red</span>
                                    <span>Size: Medium</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="item-price">
                                <span style="font-weight: 600; color: var(--primary-color);">₹1,299</span>
                                <br>
                                <span style="font-size: 12px; color: var(--text-light); text-decoration: line-through;">₹1,599</span>
                            </div>
                        </td>
                        <td>
                            <div class="quantity-controls">
                                <button class="quantity-btn decrement" data-product-id="1">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="1" min="1" data-product-id="1">
                                <button class="quantity-btn increment" data-product-id="1">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </td>
                        <td>
                            <span class="item-total" style="font-weight: 600; color: var(--text-dark);">₹1,299</span>
                        </td>
                        <td>
                            <button class="remove-item" data-product-id="1" style="color: var(--warm-orange); background: none; border: none; font-size: 18px; cursor: pointer; padding: 8px;">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                    
                    <!-- Cart Item 2 -->
                    <tr class="cart-item">
                        <td>
                            <input type="checkbox" checked style="width: 18px; height: 18px;">
                        </td>
                        <td>
                            <img src="{% static 'images/products/ceramic-pottery.jpg' %}" alt="Hand-painted Ceramic Pottery" class="cart-item-image">
                        </td>
                        <td>
                            <div class="item-details">
                                <h4 style="margin-bottom: 8px; color: var(--text-dark);">Hand-painted Ceramic Pottery</h4>
                                <p style="color: var(--text-light); font-size: 14px; margin-bottom: 4px;">Clay Crafts</p>
                                <div style="display: flex; gap: 16px; font-size: 14px; color: var(--text-light);">
                                    <span>Design: Traditional</span>
                                    <span>Size: Large</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="item-price">
                                <span style="font-weight: 600; color: var(--primary-color);">₹899</span>
                                <br>
                                <span style="font-size: 12px; color: var(--text-light); text-decoration: line-through;">₹1,199</span>
                            </div>
                        </td>
                        <td>
                            <div class="quantity-controls">
                                <button class="quantity-btn decrement" data-product-id="2">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="2" min="1" data-product-id="2">
                                <button class="quantity-btn increment" data-product-id="2">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </td>
                        <td>
                            <span class="item-total" style="font-weight: 600; color: var(--text-dark);">₹1,798</span>
                        </td>
                        <td>
                            <button class="remove-item" data-product-id="2" style="color: var(--warm-orange); background: none; border: none; font-size: 18px; cursor: pointer; padding: 8px;">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                    
                    <!-- Cart Item 3 -->
                    <tr class="cart-item">
                        <td>
                            <input type="checkbox" checked style="width: 18px; height: 18px;">
                        </td>
                        <td>
                            <img src="{% static 'images/products/bamboo-basket.jpg' %}" alt="Handwoven Bamboo Basket" class="cart-item-image">
                        </td>
                        <td>
                            <div class="item-details">
                                <h4 style="margin-bottom: 8px; color: var(--text-dark);">Handwoven Bamboo Basket</h4>
                                <p style="color: var(--text-light); font-size: 14px; margin-bottom: 4px;">Bamboo Crafts</p>
                                <div style="display: flex; gap: 16px; font-size: 14px; color: var(--text-light);">
                                    <span>Type: Storage</span>
                                    <span>Size: Medium</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="item-price">
                                <span style="font-weight: 600; color: var(--primary-color);">₹649</span>
                            </div>
                        </td>
                        <td>
                            <div class="quantity-controls">
                                <button class="quantity-btn decrement" data-product-id="3">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="1" min="1" data-product-id="3">
                                <button class="quantity-btn increment" data-product-id="3">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </td>
                        <td>
                            <span class="item-total" style="font-weight: 600; color: var(--text-dark);">₹649</span>
                        </td>
                        <td>
                            <button class="remove-item" data-product-id="3" style="color: var(--warm-orange); background: none; border: none; font-size: 18px; cursor: pointer; padding: 8px;">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Cart Actions Bar -->
        <div class="cart-actions-bar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; padding: 16px 0;">
            <div class="select-actions" style="display: flex; align-items: center; gap: 16px;">
                <label style="display: flex; align-items: center; gap: 8px; font-weight: 500;">
                    <input type="checkbox" id="selectAll" checked>
                    Select All (3 items)
                </label>
                <button class="btn btn-outline btn-small" id="removeSelected">
                    <i class="fas fa-trash-alt"></i>
                    Remove Selected
                </button>
            </div>
            
            <div class="cart-actions" style="display: flex; gap: 12px;">
                <a href="{% url 'shop' %}" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i>
                    Continue Shopping
                </a>
                <button class="btn btn-secondary" id="saveForLater">
                    <i class="fas fa-heart"></i>
                    Save for Later
                </button>
            </div>
        </div>
        
        <!-- Cart Summary -->
        <div class="cart-summary">
            <!-- Coupon Section -->
            <div class="coupon-section">
                <h3>Apply Coupon</h3>
                <p style="color: var(--text-light); font-size: 14px; margin-bottom: 16px;">Have a coupon code? Enter it below to get discount</p>
                <div class="coupon-input">
                    <input type="text" placeholder="Enter coupon code" id="couponCode">
                    <button class="btn btn-primary" id="applyCoupon">Apply</button>
                </div>
                
                <!-- Available Coupons -->
                <div class="available-coupons" style="margin-top: 20px;">
                    <h4 style="margin-bottom: 12px; font-size: 16px;">Available Offers</h4>
                    <div class="coupon-item" style="border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: var(--primary-color);">FIRST10</strong>
                                <p style="font-size: 12px; color: var(--text-light); margin: 0;">10% off on first order</p>
                            </div>
                            <button class="btn btn-small btn-outline apply-coupon-btn" data-code="FIRST10">Apply</button>
                        </div>
                    </div>
                    
                    <div class="coupon-item" style="border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: var(--primary-color);">INDIGENOUS50</strong>
                                <p style="font-size: 12px; color: var(--text-light); margin: 0;">₹50 off on orders above ₹999</p>
                            </div>
                            <button class="btn btn-small btn-outline apply-coupon-btn" data-code="INDIGENOUS50">Apply</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Order Summary -->
            <div class="order-summary">
                <h3>Order Summary</h3>
                
                <div class="summary-row">
                    <span>Subtotal (3 items)</span>
                    <span class="subtotal-amount">₹3,746</span>
                </div>
                
                <div class="summary-row">
                    <span>Discount</span>
                    <span class="discount-amount" style="color: var(--warm-orange);">-₹374</span>
                </div>
                
                <div class="summary-row">
                    <span>Shipping</span>
                    <span class="shipping-amount" style="color: var(--secondary-color);">Free</span>
                </div>
                
                <div class="summary-row">
                    <span>Tax (GST)</span>
                    <span class="tax-amount">₹337</span>
                </div>
                
                <hr style="border: none; border-top: 1px solid var(--border-color); margin: 16px 0;">
                
                <div class="summary-row" style="font-size: 18px;">
                    <span>Total</span>
                    <span class="total-amount">₹3,709</span>
                </div>
                
                <div class="savings-info" style="background-color: var(--bg-light); padding: 12px; border-radius: 8px; margin: 16px 0;">
                    <div style="color: var(--secondary-color); font-size: 14px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-leaf"></i>
                        <span>You're saving ₹374 on this order!</span>
                    </div>
                </div>
                
                <!-- Checkout Button -->
                <button class="btn btn-primary w-full btn-large" id="proceedCheckout" style="margin-bottom: 16px;">
                    <i class="fas fa-lock"></i>
                    Proceed to Checkout
                </button>
                
                <!-- Security Info -->
                <div class="security-info" style="display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 12px; color: var(--text-light);">
                    <i class="fas fa-shield-alt" style="color: var(--secondary-color);"></i>
                    <span>Secure checkout with 256-bit SSL encryption</span>
                </div>
                
                <!-- Payment Methods -->
                <div class="payment-methods" style="margin-top: 16px; text-align: center;">
                    <p style="font-size: 12px; color: var(--text-light); margin-bottom: 8px;">We accept:</p>
                    <div style="display: flex; justify-content: center; gap: 8px;">
                        <img src="{% static 'images/payments/visa.png' %}" alt="Visa" style="height: 24px;">
                        <img src="{% static 'images/payments/mastercard.png' %}" alt="Mastercard" style="height: 24px;">
                        <img src="{% static 'images/payments/upi.png' %}" alt="UPI" style="height: 24px;">
                        <img src="{% static 'images/payments/paytm.png' %}" alt="Paytm" style="height: 24px;">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recently Viewed / Recommended Products -->
        <div class="recommended-section" style="margin-top: 60px;">
            <h3 style="margin-bottom: 24px;">You might also like</h3>
            <div class="products-grid" style="grid-template-columns: repeat(4, 1fr);">
                <!-- Recommended product cards would go here -->
                <div class="product-card" data-product-id="4">
                    <div class="product-image">
                        <img src="{% static 'images/products/tribal-jewelry.jpg' %}" alt="Traditional Tribal Jewelry" loading="lazy">
                        <div class="product-actions">
                            <button class="action-btn wishlist-btn" data-product-id="4" title="Add to Wishlist">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-brand">Tribal Arts</div>
                        <h3 class="product-title">
                            <a href="{% url 'sProduct' %}">Traditional Tribal Jewelry</a>
                        </h3>
                        <div class="product-price">
                            <span class="current-price">₹2,199</span>
                            <span class="original-price">₹2,599</span>
                        </div>
                        <button class="add-to-cart" data-product-id="4">
                            <i class="fas fa-cart-plus"></i>
                            Add to Cart
                        </button>
                    </div>
                </div>
                
                <!-- More recommended products... -->
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Quantity controls
        document.querySelectorAll('.quantity-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.dataset.productId;
                const input = document.querySelector(`.quantity-input[data-product-id="${productId}"]`);
                const currentValue = parseInt(input.value);
                const isIncrement = this.classList.contains('increment');
                
                if (isIncrement) {
                    input.value = currentValue + 1;
                } else if (currentValue > 1) {
                    input.value = currentValue - 1;
                }
                
                updateCartTotals();
            });
        });
        
        // Remove item from cart
        document.querySelectorAll('.remove-item').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.dataset.productId;
                if (confirm('Are you sure you want to remove this item from your cart?')) {
                    this.closest('tr').remove();
                    updateCartTotals();
                    updateItemCount();
                }
            });
        });
        
        // Select all functionality
        document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('tbody input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = this.checked);
        });
        
        // Apply coupon
        document.querySelectorAll('.apply-coupon-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const code = this.dataset.code;
                document.getElementById('couponCode').value = code;
                applyCoupon(code);
            });
        });
        
        document.getElementById('applyCoupon').addEventListener('click', function() {
            const code = document.getElementById('couponCode').value;
            if (code) {
                applyCoupon(code);
            }
        });
        
        function applyCoupon(code) {
            // Simulate coupon application
            let discount = 0;
            switch(code) {
                case 'FIRST10':
                    discount = 374; // 10% of subtotal
                    break;
                case 'INDIGENOUS50':
                    discount = 50;
                    break;
                default:
                    alert('Invalid coupon code');
                    return;
            }
            
            document.querySelector('.discount-amount').textContent = `-₹${discount}`;
            updateCartTotals();
            showAlert(`Coupon ${code} applied successfully!`, 'success');
        }
        
        function updateCartTotals() {
            let subtotal = 0;
            
            document.querySelectorAll('.cart-item').forEach(item => {
                const priceElement = item.querySelector('.item-price span');
                const price = parseFloat(priceElement.textContent.replace('₹', '').replace(',', ''));
                const quantity = parseInt(item.querySelector('.quantity-input').value);
                const itemTotal = price * quantity;
                
                item.querySelector('.item-total').textContent = `₹${itemTotal.toLocaleString()}`;
                subtotal += itemTotal;
            });
            
            const discount = parseFloat(document.querySelector('.discount-amount').textContent.replace('-₹', '').replace(',', '')) || 0;
            const tax = Math.round(subtotal * 0.09); // 9% GST
            const total = subtotal - discount + tax;
            
            document.querySelector('.subtotal-amount').textContent = `₹${subtotal.toLocaleString()}`;
            document.querySelector('.tax-amount').textContent = `₹${tax.toLocaleString()}`;
            document.querySelector('.total-amount').textContent = `₹${total.toLocaleString()}`;
        }
        
        function updateItemCount() {
            const itemCount = document.querySelectorAll('.cart-item').length;
            document.querySelector('#selectAll').nextSibling.textContent = ` Select All (${itemCount} items)`;
        }
        
        // Proceed to checkout
        document.getElementById('proceedCheckout').addEventListener('click', function() {
            const selectedItems = document.querySelectorAll('tbody input[type="checkbox"]:checked');
            if (selectedItems.length === 0) {
                alert('Please select at least one item to checkout');
                return;
            }
            
            // Redirect to checkout page
            window.location.href = '/checkout/';
        });
    });
</script>
{% endblock %}
